---
description: 選択範囲またはカーソル位置の関数をリファクタリング
---

現在のバッファから対象のコードを取得し、以下の観点でリファクタリングを提案してください：

1. **複雑度の削減**: ネストを減らし、早期リターンを活用
2. **関数分割**: 単一責任の原則に従って適切に分割
3. **命名改善**: より明確で意図が伝わる名前に変更
4. **型安全性**: 適切な型アノテーションの追加（該当する場合）
5. **Neovim API**: より効率的な API の使用（vim.api.* vs vim.*）

リファクタリング後のコードと、変更理由を簡潔に説明してください。
