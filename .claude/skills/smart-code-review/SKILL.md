# スマートコードレビュースキル

LSP と静的解析を組み合わせた高度なコードレビューを実施します。

## レビュー項目

### 1. 構造的品質
- アーキテクチャパターンの適合性
- モジュール間の依存関係
- 責務の分離（SRP）

### 2. パフォーマンス
- 非効率なループやアルゴリズム
- 不要な再計算
- メモリリークの可能性

### 3. セキュリティ
- インジェクション脆弱性
- 不適切な入力検証
- 認証・認可の問題

### 4. Neovim 固有
- `vim.schedule` の適切な使用
- ブロッキング操作の検出
- プラグインパフォーマンスへの影響

### 5. 保守性
- コードの複雑度
- ネーミングの一貫性
- テストカバレッジ

## レビュープロセス

```text
1. LSP で型情報・診断を収集
   ↓
2. 静的解析でパターン検出
   ↓
3. ベストプラクティスと照合
   ↓
4. 優先度付きで改善提案
   ↓
5. 必要に応じてリファクタリング案を提示
```

## 出力形式

```markdown
## コードレビュー結果

### 🔴 Critical（即修正推奨）
- [セキュリティ] SQL インジェクションのリスク (auth.lua:45)
- [バグ] nil チェック漏れ (utils.lua:12)

### 🟡 Warning（要検討）
- [パフォーマンス] ループ内での重複計算 (parser.lua:78)
- [保守性] 複雑度が高い関数（15 → 8 を推奨） (handler.lua:120)

### 🟢 Suggestion（改善案）
- [スタイル] 変数名を camelCase → snake_case に統一
- [ドキュメント] パブリック API に型アノテーション追加

### ✅ Good Practices
- 適切なエラーハンドリング
- 非同期処理の正しい実装
```

## 使用トリガー

- 「このコードをレビューして」
- 「問題点を指摘して」
- 「セキュリティリスクを確認して」
- 「パフォーマンスを改善できるか見て」

## 追加機能

- **diff ベースレビュー**: git diff と組み合わせて変更点のみレビュー
- **段階的改善**: 優先度の高い項目から順に修正
- **学習モード**: なぜその改善が必要かの説明付き
